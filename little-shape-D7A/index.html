<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <script src="https://unpkg.com/memfetch@1.1.2/dist/index.js"></script>
  <title>Spectrum mem visualiser</title>
<style id="jsbin-css">
pre {
	font-family: 'Commodore-64-Angled', 'ZX-Spectrum', monospace;
  letter-spacing: 0px;
  background: rgb(255, 255, 255);
  border: 2px solid rgb(204, 204, 204);
  padding: 10px;
  display: block;
  margin: 0 auto;
  max-width: 600px;
  overflow-wrap: break-word;
  white-space: normal;
  line-height: 27px;
  font-size: 24px;
  
  display: none;
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}

_body {
  background: url(http://localhost:5000/old-tv.jpg) no-repeat center;
  background-position: center;
  background-size: 1248px;
  display: flex;
  align-items: center;
  justify-content: center;
}

body {
/*   background: url(http://localhost:5000/old-tv.svg) no-repeat center; */
  background-position: center;
  background-size: 512px;
  display: flex;
  align-items: center;
  justify-content: center;
  
  background: #fdfdfd;
  background-image: linear-gradient(to bottom, #cfd9df 0%, #e2ebf0 100%);
}

canvas {
	background: #fff;
  border: 10px solid black;
  display: block;
  border-radius: 0px;

  transform: scale(1);
  image-rendering: pixelated;
}
</style>
</head>
<body>
<canvas></canvas>
  <script id="memory" type="memory">
4000	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4008	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4010	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4018	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4020	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4028	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4030	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4038	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4040	DEFB $00,$00,$00,$00,$00,$00,$3F,$FF	
4048	DEFB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF	
4050	DEFB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF	
4058	DEFB $FF,$FC,$00,$00,$00,$00,$00,$00	
4060	DEFB $00,$00,$00,$00,$00,$00,$3C,$3F	
4068	DEFB $FF,$FC,$3F,$C3,$FC,$00,$3C,$3F	
4070	DEFB $C0,$03,$C3,$C0,$3F,$FC,$3F,$FF	
4078	DEFB $FC,$3C,$00,$00,$00,$00,$00,$00	
4080	DEFB $00,$00,$00,$00,$00,$00,$3C,$3C	
4088	DEFB $00

408C	DEFB $C0,$00,$00,$00,$03,$C0,$3F,$C3	
4094	DEFB $FC,$3C,$3C,$00,$3C,$3C,$00,$00	
409C	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
40A4	DEFB $00,$00,$3C,$3F,$FF,$FC,$3F,$C0	
40AC	DEFB $00,$3F,$C0,$00,$3F,$FC,$00,$00	
40B4	DEFB $3F,$FC,$3F,$FF,$FC,$3C,$00,$00	
40BC	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
40C4	DEFB $00,$00,$3F,$FF,$FF,$FF,$FF,$C0	
40CC	DEFB $00,$3C,$3C,$03,$FF,$C3,$FF,$FC	
40D4	DEFB $00,$3F,$FF,$FF,$FF,$FC,$00,$00	
40DC	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
40E4	DEFB $00,$00,$3C,$03,$C3,$C3,$C3,$C0	
40EC	DEFB $3F,$FC,$3C,$00,$03,$FF,$FC,$00	
40F4	DEFB $3C,$03,$FC,$3C,$3F,$FC,$00,$00	
40FC	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4104	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
410C	DEFB $00,$20,$00,$00,$00,$00,$00,$00	
4114	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
411C	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4124	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
412C	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4134	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
413C	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4144	DEFB $00,$00,$3F,$FF,$FF,$FF,$FF,$FF	
414C	DEFB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF	
4154	DEFB $FF,$FF,$FF,$FF,$FF,$FC,$00,$00	
415C	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4164	DEFB $00,$00,$3C,$3F,$FF,$FC,$3F,$C3	
416C	DEFB $FC,$00,$3C,$3F,$C0,$03,$C3,$C0	
4174	DEFB $3F,$FC,$3F,$FF,$FC,$3C,$00,$00	
417C	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
4184	DEFB $00,$00,$3C,$3C,$00
551A	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
5522	DEFB $00,$00,$00,$00,$3C,$00,$00,$00	
552A	DEFB $3C,$3C,$00,$3F,$FF,$FF,$FC,$00	
5532	DEFB $00,$3F,$FC,$FA,$3C,$00,$3C,$3C	
553A	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
5542	DEFB $00,$00,$00,$00,$3C,$3C,$00,$3C	
554A	DEFB $3C,$00,$3F,$FF,$C0,$00,$3F,$FF	
5552	DEFB $C0,$3C,$00,$00,$00,$3F,$C0,$3C	
555A	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
5562	DEFB $00,$00,$00,$00,$00,$F0,$F0,$00	
556A	DEFB $F0,$FF,$0F,$0F,$FF,$0F,$F0,$0F	
5572	DEFB $F0,$F0,$F0,$F0,$FF,$00,$0F,$00	
557A	DEFB $F0,$00,$00,$00,$00,$00,$00,$00	
5582	DEFB $00,$00,$00,$00,$3C,$00,$00,$00	
558A	DEFB $3F,$C3,$C0,$00,$03,$C0,$3F,$C0	
5592	DEFB $3C,$3F,$FC,$3F,$FF,$FF,$FC,$3C	
559A	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55A2	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55AA	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55B2	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55BA	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55C2	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55CA	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55D2	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55DA	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55E2	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55EA	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55F2	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
55FA	DEFB $00,$00,$00,$00,$00,$00,$00,$00	
5602	DEFB $00,$00,$00,$00	

</script>
<!--boot js--><script id="jsbin-javascript" defer>function capturePreview(id, value, preview) {
  var detail = { id: id, value: preview != null ? JSON.stringify(preview) : value };if (preview !== null) {
    // eslint-disable-next-line no-restricted-globals
    self.dispatchEvent(new CustomEvent('preview', { detail: detail }));
  }return value;
}
const canvas = document.querySelector('canvas');
const ctx = canvas.getContext('2d');
const w = canvas.width = 256;
const h = canvas.height = 192;

function put(ctx, imageData, x, y) {
  ctx.putImageData(imageData, x, y);
}

function block(index, byte) {
  const third = index >> 11; // 0..2047, 2048..4095, 4096..6143
  const imageData = new Uint8ClampedArray(4 * 8); // 1x8 pixel array

  var _LP = Date.now();

  for (let j = 7; j >= 0; j--) {
    if (Date.now() - _LP > 100) {
      (function (lineno, colno) {
        var detail = { error: { name: 'loopProtect', stack: 'Use // noprotect to disable JS Bin\'s loop protection' }, lineno: lineno, custom: true, colno: colno, message: 'Exiting potential infinite loop on line ' + lineno }; // important: this code is run inside the runner - but it's assigned from the
        // outer frame (Result)
        // eslint-disable-next-line no-restricted-globals
        self.dispatchEvent(new CustomEvent('error', { detail: detail }));
      })(14, 2);

      break;
    }

    // determines bit for i, based on MSb
    const bit = (byte & 1 << j) === 0 ? 0 : 255;
    imageData.set([bit, bit, bit, 255], (7 - j) * 4); // place the bits forward
  }

  const x = index % 32;
  const y = (index >> 5) * 8 % 64 + third * 56; // this is the y coord
  const offset = index >> 8;

  put(ctx, new ImageData(imageData, 8, 1), x * 8, y + offset);
}

// 32 bytes on 192 rows


function drawMemory(memory) {
  memory.map((line, i) => {
    line.bytes.map((byte, i) => {
      block(line.address + i - 0x4000, byte);
    });
  });
}

async function getData() {
  const res = await fetch('http://localhost:53107/bander-memory.tap');
  const data = await res.arrayBuffer();

  console.log('worked', data.byteLength);

  const bytes = Array.from(data).reduce((acc, curr, i) => {
    if (!acc[acc.length - 1].bytes) {
      acc[acc.length - 1] = { bytes: [], address: 0x4000 + i };
    }

    if (i % 8 !== 0) {
      acc[acc.length - 1].bytes.push(curr);
    }

    return acc;
  }, []);

  drawMemory(bytes);
}

function parse(data) {
  const lines = data.split('\n').map(_ => _.replace(/;.*$/, '').trim()) // remove comments
  .filter(Boolean) // strip empty lines
  .map(line => {
    const [address, cmd, memory] = line.split(/\s+/);

    const bytes = memory.split(',').map(_ => parseInt(_.substring(1), 16));

    return {
      address: parseInt(address.replace(/^b/, ''), 16),
      bytes
    };
  });

  return capturePreview(74, lines, (() => {
    try {
      return lines[0];
    } catch (e) {}return null;
  })()); //? lines[0]
}

// const data = parse(document.querySelector('#memory').innerText.trim());

// drawMemory(data);
getData();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVkaXQuanMiXSwibmFtZXMiOlsiY2FwdHVyZVByZXZpZXciLCJpZCIsInZhbHVlIiwicHJldmlldyIsImRldGFpbCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZWxmIiwiZGlzcGF0Y2hFdmVudCIsIkN1c3RvbUV2ZW50IiwiY2FudmFzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY3R4IiwiZ2V0Q29udGV4dCIsInciLCJ3aWR0aCIsImgiLCJoZWlnaHQiLCJwdXQiLCJpbWFnZURhdGEiLCJ4IiwieSIsInB1dEltYWdlRGF0YSIsImJsb2NrIiwiaW5kZXgiLCJieXRlIiwidGhpcmQiLCJVaW50OENsYW1wZWRBcnJheSIsImoiLCJsaW5lbm8iLCJjb2xubyIsImVycm9yIiwibmFtZSIsInN0YWNrIiwiY3VzdG9tIiwibWVzc2FnZSIsImJpdCIsInNldCIsIm9mZnNldCIsIkltYWdlRGF0YSIsImRyYXdNZW1vcnkiLCJtZW1vcnkiLCJtYXAiLCJsaW5lIiwiaSIsImJ5dGVzIiwiYWRkcmVzcyIsImdldERhdGEiLCJyZXMiLCJmZXRjaCIsImRhdGEiLCJhcnJheUJ1ZmZlciIsImNvbnNvbGUiLCJsb2ciLCJieXRlTGVuZ3RoIiwiQXJyYXkiLCJmcm9tIiwicmVkdWNlIiwiYWNjIiwiY3VyciIsImxlbmd0aCIsInB1c2giLCJwYXJzZSIsImxpbmVzIiwic3BsaXQiLCJfIiwicmVwbGFjZSIsInRyaW0iLCJmaWx0ZXIiLCJCb29sZWFuIiwiY21kIiwicGFyc2VJbnQiLCJzdWJzdHJpbmciLCJlIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxjQUFULENBQXdCQyxFQUF4QixFQUE0QkMsS0FBNUIsRUFBbUNDLE9BQW5DLEVBQTRDO0FBQzFDLE1BQUlDLFNBQVMsRUFDWEgsSUFBSUEsRUFETyxFQUVYQyxPQUFPQyxXQUFXLElBQVgsR0FBa0JFLEtBQUtDLFNBQUwsQ0FBZUgsT0FBZixDQUFsQixHQUE0Q0QsS0FGeEMsRUFBYixDQUtBLElBQUlDLFlBQVksSUFB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QUFTeUIsU0FBU3pCLFFBQVFvQixPQUFSLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLENBQVQsRUFBb0MsRUFBcEMsQ0FESjtBQUVMckI7QUFGSyxLQUFQO0FBSUQsR0FiVyxDQUFkOztBQWVBLDRCQUFPa0IsS0FBUCxFQTFFRixDQUFDLE1BQUk7QUFBQyxRQUFJO0FBQUUsYUFBUUEsTUFBTSxDQUFOLENBQVI7QUFBa0IsS0FBeEIsQ0FBeUIsT0FBTVUsQ0FBTixFQUFRLENBQUUsQ0FBQyxPQUFPLElBQVA7QUFBWSxHQUF0RCxHQTBFRSxFQWhCbUIsQ0FnQkw7QUFDZjs7QUFFRDs7QUFFQTtBQUNBMUIiLCJmaWxlIjoidW5rbm93biIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpO1xuY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5jb25zdCB3ID0gY2FudmFzLndpZHRoID0gMjU2O1xuY29uc3QgaCA9IGNhbnZhcy5oZWlnaHQgPSAxOTI7XG5cbmZ1bmN0aW9uIHB1dChjdHgsIGltYWdlRGF0YSwgeCwgeSkge1xuICBjdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgeCwgeSk7XG59XG5cbmZ1bmN0aW9uIGJsb2NrKGluZGV4LCBieXRlKSB7XG4gIGNvbnN0IHRoaXJkID0gaW5kZXggPj4gMTE7IC8vIDAuLjIwNDcsIDIwNDguLjQwOTUsIDQwOTYuLjYxNDNcbiAgY29uc3QgaW1hZ2VEYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDQgKiA4KTsgLy8gMXg4IHBpeGVsIGFycmF5XG5cbiAgZm9yIChsZXQgaiA9IDc7IGogPj0gMDsgai0tKSB7XG4gICAgLy8gZGV0ZXJtaW5lcyBiaXQgZm9yIGksIGJhc2VkIG9uIE1TYlxuICAgIGNvbnN0IGJpdCA9IChieXRlICYgKDEgPDwgaikpID09PSAwID8gMCA6IDI1NTtcbiAgICBpbWFnZURhdGEuc2V0KFtiaXQsIGJpdCwgYml0LCAyNTVdLCAoNyAtIGopICogNCk7IC8vIHBsYWNlIHRoZSBiaXRzIGZvcndhcmRcbiAgfVxuXG4gIGNvbnN0IHggPSBpbmRleCAlIDMyO1xuICBjb25zdCB5ID0gKChpbmRleCA+PiA1KSAqIDgpICUgNjQgKyB0aGlyZCAqIDU2OyAvLyB0aGlzIGlzIHRoZSB5IGNvb3JkXG4gIGNvbnN0IG9mZnNldCA9IGluZGV4ID4+IDg7XG5cbiAgcHV0KGN0eCwgbmV3IEltYWdlRGF0YShpbWFnZURhdGEsIDgsIDEpLCB4ICogOCwgeSArIG9mZnNldCk7XG59XG5cbi8vIDMyIGJ5dGVzIG9uIDE5MiByb3dzXG5cblxuZnVuY3Rpb24gZHJhd01lbW9yeShtZW1vcnkpIHtcblx0bWVtb3J5Lm1hcCgobGluZSwgaSkgPT4ge1xuICAgIGxpbmUuYnl0ZXMubWFwKChieXRlLCBpKSA9PiB7XG5cdFx0XHRibG9jaygobGluZS5hZGRyZXNzICsgaSkgLSAweDQwMDAsIGJ5dGUpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RGF0YSgpIHtcbiAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6NTMxMDcvYmFuZGVyLW1lbW9yeS50YXAnKTtcbiAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5hcnJheUJ1ZmZlcigpO1xuICBcbiAgY29uc29sZS5sb2coJ3dvcmtlZCcsIGRhdGEuYnl0ZUxlbmd0aClcbiAgXG4gIGNvbnN0IGJ5dGVzID0gQXJyYXkuZnJvbShkYXRhKS5yZWR1Y2UoKGFjYywgY3VyciwgaSkgPT4ge1xuICAgIGlmICghYWNjW2FjYy5sZW5ndGggLSAxXS5ieXRlcykge1xuICAgICAgYWNjW2FjYy5sZW5ndGggLSAxXSA9IHsgYnl0ZXM6IFtdLCBhZGRyZXNzOiAweDQwMDAgKyBpIH07XG4gICAgfVxuICAgIFxuICAgIGlmIChpICUgOCAhPT0gMCkge1xuICAgICAgYWNjW2FjYy5sZW5ndGggLSAxXS5ieXRlcy5wdXNoKGN1cnIpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gYWNjO1xuICB9LCBbXSk7XG4gIFxuICBkcmF3TWVtb3J5KGJ5dGVzKTtcbn1cblxuZnVuY3Rpb24gcGFyc2UoZGF0YSkge1xuICBjb25zdCBsaW5lcyA9IGRhdGFcbiAgXHQuc3BsaXQoJ1xcbicpXG4gIFx0Lm1hcChfID0+IF8ucmVwbGFjZSgvOy4qJC8sICcnKS50cmltKCkpIC8vIHJlbW92ZSBjb21tZW50c1xuICBcdC5maWx0ZXIoQm9vbGVhbikgLy8gc3RyaXAgZW1wdHkgbGluZXNcbiAgXHQubWFwKGxpbmUgPT4ge1xuICAgICAgY29uc3QgW2FkZHJlc3MsIGNtZCwgbWVtb3J5XSA9IGxpbmUuc3BsaXQoL1xccysvKTtcbiAgICAgIFxuICAgICAgY29uc3QgYnl0ZXMgPSBtZW1vcnkuc3BsaXQoJywnKS5tYXAoXyA9PiBwYXJzZUludChfLnN1YnN0cmluZygxKSwgMTYpKVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhZGRyZXNzOiBwYXJzZUludChhZGRyZXNzLnJlcGxhY2UoL15iLywgJycpLCAxNiksIFxuICAgICAgICBieXRlcyxcbiAgICAgIH1cbiAgICB9KTtcbiAgXG4gIHJldHVybiBsaW5lczsgLy8/IGxpbmVzWzBdXG59XG5cbi8vIGNvbnN0IGRhdGEgPSBwYXJzZShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWVtb3J5JykuaW5uZXJUZXh0LnRyaW0oKSk7XG5cbi8vIGRyYXdNZW1vcnkoZGF0YSk7XG5nZXREYXRhKCk7XG4iXX0=
</script>



<script id="jsbin-source-javascript" type="text/source-javascript">const canvas = document.querySelector('canvas');
const ctx = canvas.getContext('2d');
const w = canvas.width = 256;
const h = canvas.height = 192;

function put(ctx, imageData, x, y) {
  ctx.putImageData(imageData, x, y);
}

function block(index, byte) {
  const third = index >> 11; // 0..2047, 2048..4095, 4096..6143
  const imageData = new Uint8ClampedArray(4 * 8); // 1x8 pixel array

  for (let j = 7; j >= 0; j--) {
    // determines bit for i, based on MSb
    const bit = (byte & (1 << j)) === 0 ? 0 : 255;
    imageData.set([bit, bit, bit, 255], (7 - j) * 4); // place the bits forward
  }

  const x = index % 32;
  const y = ((index >> 5) * 8) % 64 + third * 56; // this is the y coord
  const offset = index >> 8;

  put(ctx, new ImageData(imageData, 8, 1), x * 8, y + offset);
}

// 32 bytes on 192 rows


function drawMemory(memory) {
	memory.map((line, i) => {
    line.bytes.map((byte, i) => {
			block((line.address + i) - 0x4000, byte);
    });
  });
}

async function getData() {
  const res = await fetch('http://localhost:53107/bander-memory.tap');
  const data = await res.arrayBuffer();
  
  console.log('worked', data.byteLength)
  
  const bytes = Array.from(data).reduce((acc, curr, i) => {
    if (!acc[acc.length - 1].bytes) {
      acc[acc.length - 1] = { bytes: [], address: 0x4000 + i };
    }
    
    if (i % 8 !== 0) {
      acc[acc.length - 1].bytes.push(curr);
    }
    
    return acc;
  }, []);
  
  drawMemory(bytes);
}

function parse(data) {
  const lines = data
  	.split('\n')
  	.map(_ => _.replace(/;.*$/, '').trim()) // remove comments
  	.filter(Boolean) // strip empty lines
  	.map(line => {
      const [address, cmd, memory] = line.split(/\s+/);
      
      const bytes = memory.split(',').map(_ => parseInt(_.substring(1), 16))
      
      return {
        address: parseInt(address.replace(/^b/, ''), 16), 
        bytes,
      }
    });
  
  return lines; //? lines[0]
}

// const data = parse(document.querySelector('#memory').innerText.trim());

// drawMemory(data);
getData();

</script></body>
</html>